#!/usr/bin/env zsh

# Ensure this gets sourced
source $HOME/.zshenv

# Silently start some programs in the background
(! pgrep -f mpd && mpd) &> /dev/null
(! pgrep -f syncthing && syncthing --no-browser &) &> /dev/null
(! pgrep -f radicale && radicale &) &> /dev/null
(! pgrep -f ssh-agent && rm -f "$SSH_AUTH_SOCK" && eval $(ssh-agent -a "$SSH_AUTH_SOCK")) &> /dev/null

# Present a session picker and power menu
while true; do
	print '\nChoose an option:\n\n' \
		'1) Start X11\n' \
		'2) Start tmux\n\n' \
		'3) Logout\n' \
		'4) Suspend\n' \
		'5) Reboot\n' \
		'6) Shutdown\n'

	read NUM\?'(number) '
	case $NUM in
		1) startx &> /dev/null ;;
		2) tmux ;;
		3) exit ;;
		4) qsuspend && sleep 5s ;;
		5) qreboot && exit ;;
		6) qpoweroff && exit ;;
	esac
done
